<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyvern Server Status — GhostTrack</title>
    <meta name="description"
        content="Check Wyvern MMORPG server status in real-time. Discover Wyvern's unique features, 17 player races, 100+ spells, quests, cross-platform support, free-to-play gameplay, and more.">
    <meta name="keywords"
        content="Wyvern MMORPG, Wyvern server status, online Wyvern game, Wyvern features, Wyvern free-to-play, Wyvern mobile, Wyvern Steam, Wyvern MMO, Wyvern quests, Wyvern cross-platform, Wyvern spells, Wyvern guilds">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes flash {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.2;
            }
        }

        .flash {
            animation: flash 0.5s ease-in-out;
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 flex flex-col items-center justify-center min-h-screen">
    <img src="logo.png" alt="Wyvern Banner" class="mb-4">

    <nav class="bg-gray-800 rounded-2xl border-b border-gray-700 mb-4">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Title - Centered on its own line -->
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-white">Wyvern Server Status</h1>
            </div>

            <!-- Get It Now Section -->
            <div class="text-center mb-4">
                <span class="text-gray-400 text-sm font-semibold uppercase tracking-wide mr-4">Get It Now:</span>
                <a href="https://ghosttrack.com" target="_blank"
                    class="text-blue-400 hover:text-blue-300 transition-colors duration-200 pr-4 mr-4 border-r border-gray-600">
                    GhostTrack
                </a>
                <a href="https://store.steampowered.com/app/1541710/Wyvern/" target="_blank"
                    class="text-blue-400 hover:text-blue-300 transition-colors duration-200">
                    Steam
                </a>
            </div>

            <!-- Learn More Section -->
            <div class="text-center">
                <span class="text-gray-400 text-sm font-semibold uppercase tracking-wide mr-4">Learn More:</span>
                <a href="https://www.reddit.com/r/wyvernrpg/" target="_blank"
                    class="text-blue-400 hover:text-blue-300 transition-colors duration-200 pr-4 mr-4 border-r border-gray-600">
                    Reddit
                </a>
                <a href="https://discord.com/invite/c2BcUu2" target="_blank"
                    class="text-blue-400 hover:text-blue-300 transition-colors duration-200 pr-4 mr-4 border-r border-gray-600">
                    Discord
                </a>
                <a href="https://wiki.wyvernsource.com/index.php/Main_Page" target="_blank"
                    class="text-blue-400 hover:text-blue-300 transition-colors duration-200">
                    Wiki
                </a>
            </div>
        </div>
    </nav>

    <main class="bg-gray-800 rounded-2xl shadow-lg p-8 text-center w-80 mb-4">
        <div id="status-box" class="flex flex-col items-center mb-6">
            <div class="flex items-center gap-2 mb-4">
                <div id="status-dot" class="w-4 h-4 rounded-full bg-gray-500"></div>
                <span id="status-text" class="text-lg font-semibold">Connecting...</span>
            </div>
            <p id="player-count" class="text-gray-400 text-sm">Players Online: —</p>
            <p id="last-update" class="text-gray-400 text-xs mt-2">Last update: 0s ago</p>
        </div>

        <button id="open-steam" class="mt-6 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition">
            Launch Wyvern From Steam
        </button>

        <div id="downtime-history" class="mt-4 text-left w-full">
            <h2 class="text-sm font-semibold mb-1">Last 72 Hours Downtime History:</h2>
            <p class="text-xs text-gray-500 mb-4">Persistent tracking across all users</p>
            <div id="ongoing-downtime" class="mb-4 hidden">
                <p class="text-xs text-orange-400">⚠️ <span id="ongoing-text">Ongoing downtime...</span></p>
            </div>
            <ul id="downtime-list" class="text-xs text-gray-300 space-y-1 max-h-40 overflow-y-auto">
                <li class="text-gray-500">Loading history...</li>
            </ul>
            <p id="total-downtime" class="text-xs text-gray-400 mt-2"></p>
        </div>
    </main>

    <!-- Wyvern SEO / Game Description Section -->
    <section class="max-w-4xl mx-auto text-gray-200 text-left px-4 sm:px-6 lg:px-0 space-y-4">
        <h2 class="text-2xl font-bold">About Wyvern</h2>
        <p>Wyvern is a command-oriented MMORPG with hundreds of commands for social actions, emotes, crafting,
            inventory management, and more. Players can bind commands to hotkeys or create custom aliases and macros for
            flexible gameplay.</p>

        <h2 class="text-2xl font-bold">Features</h2>
        <ul class="list-disc list-inside space-y-1">
            <li>17 unique player races: humans, elves, fighting cats, giants, vampires, and more</li>
            <li>Over 50 quests with unique rewards</li>
            <li>Builder Mode (level editor) for custom areas</li>
            <li>Guild system to specialize and enhance abilities</li>
            <li>100+ unique spells and magic items</li>
            <li>Hundreds of playable areas: towns, dungeons, ruins, underwater realms</li>
            <li>500+ monsters with weapons, spells, and summoning abilities</li>
            <li>Random Dungeon system for endless adventure</li>
            <li>Player groups, support roles, and adventuring facilities</li>
            <li>Raid bosses, Live Quests, and other endgame events</li>
            <li>Custom character images at level 25</li>
            <li>Friendly, active community</li>
        </ul>

        <h2 class="text-2xl font-bold">Physics & Gameplay</h2>
        <ul class="list-disc list-inside space-y-1">
            <li>2D tile-based game with rich lighting and day/night cycles</li>
            <li>Missiles, projectiles, area-of-effect spells</li>
            <li>Interactive objects: pushable gates, traps, vehicles</li>
            <li>Multiple damage types, resistances, and vulnerabilities</li>
            <li>Side-scroller engine for certain quests and areas</li>
            <li>Sophisticated camera system for detection and scrying</li>
            <li>Realistic body-part system for equipment layering</li>
            <li>Thousands of objects supporting economy, quests, and guilds</li>
        </ul>

        <h2 class="text-2xl font-bold">Cross-Platform Support</h2>
        <p>Wyvern runs on Windows, Mac, Linux (non-Steam clients), and mobile platforms (iOS & Android). All platforms
            share
            the same servers, enabling seamless cross-play. Accounts can be linked across Steam, Gmail, Apple, or
            Facebook.</p>

        <h2 class="text-2xl font-bold">Free-to-Play Model</h2>
        <p>Wyvern is free-to-play with optional in-game purchases (Wyvern Crowns) for convenience, not power. Nearly all
            content is accessible to free players. VIP perks are minor and focus on quality-of-life improvements.</p>

        <h2 class="text-2xl font-bold">Learning Curve</h2>
        <p>Wyvern has a steep learning curve due to its depth and decades of development. A tutorial exists, but
            patience
            rewards players with an immersive and challenging MMORPG experience.</p>
    </section>

    <footer class="mt-8 text-gray-500 text-sm">&copy; 2025 GhostTrack Studios; Web Page Created by Max Uland
    </footer>

    <script>
        const statusDot = document.getElementById("status-dot");
        const statusText = document.getElementById("status-text");
        const playerCount = document.getElementById("player-count");
        const lastUpdate = document.getElementById("last-update");
        const downtimeList = document.getElementById("downtime-list");
        const ongoingDowntimeDiv = document.getElementById("ongoing-downtime");
        const ongoingText = document.getElementById("ongoing-text");
        const totalDowntimeEl = document.getElementById("total-downtime");

        const WORKER_URL = 'https://wyvern-server-status.williamuland12.workers.dev';
        const POLL_INTERVAL = 10000;

        let secondsSinceUpdate = 0;

        function flashDot() {
            statusDot.classList.add("flash");
            setTimeout(() => statusDot.classList.remove("flash"), 500);
        }

        function updateServerUI(online, totalPlayers) {
            flashDot();
            statusDot.classList.toggle("bg-green-500", online);
            statusDot.classList.toggle("bg-red-500", !online);
            statusDot.classList.toggle("bg-gray-500", false);
            statusText.textContent = online ? "Online" : "Offline";
            playerCount.textContent = `Players Online: ${totalPlayers}`;
        }

        function formatDuration(ms) {
            const seconds = Math.floor(ms / 1000);
            if (seconds < 60) return `${seconds}s`;
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            if (mins < 60) return `${mins}m ${secs}s`;
            const hours = Math.floor(mins / 60);
            const remainMins = mins % 60;
            if (hours < 24) return `${hours}h ${remainMins}m`;
            const days = Math.floor(hours / 24);
            const remainHours = hours % 24;
            return `${days}d ${remainHours}h`;
        }

        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const isToday = date.toDateString() === now.toDateString();

            if (isToday) {
                return date.toLocaleTimeString();
            } else {
                return date.toLocaleString(undefined, {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        async function fetchDowntimeHistory() {
            try {
                const response = await fetch(`${WORKER_URL}/downtimes`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();

                // Update ongoing downtime
                if (data.ongoingDowntime) {
                    ongoingDowntimeDiv.classList.remove('hidden');
                    const duration = formatDuration(data.ongoingDowntime.duration);
                    const startTime = formatDateTime(data.ongoingDowntime.start);
                    ongoingText.textContent = `Ongoing downtime since ${startTime} (${duration})`;
                } else {
                    ongoingDowntimeDiv.classList.add('hidden');
                }

                // Update downtime list
                if (data.downtimes && data.downtimes.length > 0) {
                    downtimeList.innerHTML = "";

                    // Calculate total downtime
                    let totalMs = data.downtimes.reduce((sum, d) => sum + d.duration, 0);
                    if (data.ongoingDowntime) {
                        totalMs += data.ongoingDowntime.duration;
                    }

                    totalDowntimeEl.textContent = `Total downtime (72h): ${formatDuration(totalMs)}`;

                    data.downtimes.forEach(d => {
                        const li = document.createElement("li");
                        const startTime = formatDateTime(d.start);
                        const endTime = formatDateTime(d.end);
                        const duration = formatDuration(d.duration);
                        li.innerHTML = `<span class="text-red-400">●</span> ${startTime} → ${endTime} <span class="text-gray-400">(${duration})</span>`;
                        downtimeList.appendChild(li);
                    });
                } else {
                    downtimeList.innerHTML = '<li class="text-gray-500">No downtimes in last 72 hours</li>';
                    totalDowntimeEl.textContent = '';
                }
            } catch (error) {
                console.error("Failed to fetch downtime history:", error);
                downtimeList.innerHTML = '<li class="text-red-400">Failed to load history</li>';
            }
        }

        async function fetchServerStatus() {
            try {
                const response = await fetch(WORKER_URL);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                let totalPlayers = 0;
                let anyOnline = false;

                if (data.servers && data.servers.length > 0) {
                    data.servers.forEach(server => {
                        totalPlayers += server.players || 0;
                        if (server.online || server.state === "READY") {
                            anyOnline = true;
                        }
                    });
                }

                updateServerUI(anyOnline, totalPlayers);

            } catch (error) {
                console.error("Failed to fetch server status:", error);
                updateServerUI(false, 0);
            }

            secondsSinceUpdate = 0;
        }

        // Update "last update" counter every second
        setInterval(() => {
            secondsSinceUpdate++;
            lastUpdate.textContent = `Last update: ${secondsSinceUpdate}s ago`;
        }, 1000);

        // Initial fetch and setup polling
        (async () => {
            await fetchServerStatus();
            await fetchDowntimeHistory();

            setInterval(fetchServerStatus, POLL_INTERVAL);
            setInterval(fetchDowntimeHistory, 30000); // Update history every 30s
        })();

        document.getElementById("open-steam").addEventListener("click", () => {
            window.location.href = "steam://rungameid/1541710";
        });
    </script>
</body>

</html>