<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyvern Server Status — GhostTrack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes flash {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.2;
            }
        }

        .flash {
            animation: flash 0.5s ease-in-out;
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 flex flex-col items-center justify-center min-h-screen">

    <header class="mb-8 text-center">
        <h1 class="text-4xl font-bold mb-2">Wyvern Server Status</h1>
        <a href="https://ghosttrack.com" target="_blank" class="text-blue-400 hover:underline">Visit GhostTrack.com</a>
    </header>

    <main class="bg-gray-800 rounded-2xl shadow-lg p-8 text-center w-80">
        <div id="status-box" class="flex flex-col items-center">
            <div class="flex items-center gap-2 mb-2">
                <div id="status-dot" class="w-4 h-4 rounded-full bg-gray-500"></div>
                <span id="status-text" class="text-lg font-semibold">Connecting...</span>
            </div>
            <p id="player-count" class="text-gray-400 text-sm">Players Online: —</p>
            <p id="last-update" class="text-gray-400 text-xs mt-2">Last update: 0s ago</p>


        </div>

        <button id="open-steam" class="mt-6 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition">
            Launch Wyvern on Steam
        </button>
        <div id="downtime-history" class="mt-4 text-left w-full">
            <h2 class="text-sm font-semibold mb-1">Last 5 Downtimes:</h2>
            <ul id="downtime-list" class="text-xs text-gray-300 space-y-1">
                <!-- Downtime entries go here -->
            </ul>
        </div>
    </main>

    <footer class="mt-8 text-gray-500 text-sm">&copy; 2025 GhostTrack Studios</footer>

    <script>
        const statusDot = document.getElementById("status-dot");
        const statusText = document.getElementById("status-text");
        const playerCount = document.getElementById("player-count");
        const lastUpdate = document.getElementById("last-update");
        const downtimeList = document.getElementById("downtime-list");

        const POLL_INTERVAL = 10000; // 10 seconds
        let secondsSinceUpdate = 0;
        let serverOnline = true; // Track previous state

        // Track last 5 downtimes
        let downtimeHistory = [];

        function flashDot() {
            statusDot.classList.add("flash");
            setTimeout(() => statusDot.classList.remove("flash"), 500);
        }

        function setOnline() {
            statusDot.classList.remove("bg-red-500", "animate-pulse");
            statusDot.classList.add("bg-green-500");
            statusText.textContent = "Online";
            playerCount.textContent = "Players Online: —";
        }

        function setOffline() {
            statusDot.classList.remove("bg-green-500");
            statusDot.classList.add("bg-red-500", "animate-pulse");
            statusText.textContent = "Offline";
            playerCount.textContent = "Players Online: —";
        }

        function recordDowntime(startTime, endTime) {
            const durationSec = Math.round((endTime - startTime) / 1000);
            downtimeHistory.unshift({ start: startTime, end: endTime, duration: durationSec });
            if (downtimeHistory.length > 5) downtimeHistory.pop();
            renderDowntimes();
        }

        function renderDowntimes() {
            downtimeList.innerHTML = "";
            downtimeHistory.forEach(d => {
                const li = document.createElement("li");
                const startStr = new Date(d.start).toLocaleTimeString();
                li.textContent = `${startStr} — ${d.duration}s`;
                downtimeList.appendChild(li);
            });
        }

        // Simulated poll function
        let currentDowntimeStart = null;

        async function updateStatus() {
            flashDot();
            try {
                // Replace this with your real server check logic
                const isOnline = true; // Example: always online

                if (isOnline) {
                    if (!serverOnline && currentDowntimeStart) {
                        // Server just came back online
                        const end = new Date();
                        recordDowntime(currentDowntimeStart, end);
                        currentDowntimeStart = null;
                    }
                    setOnline();
                } else {
                    if (serverOnline) {
                        // Server just went offline
                        currentDowntimeStart = new Date();
                    }
                    setOffline();
                }
                serverOnline = isOnline;
            } catch (e) {
                console.error("Error checking server:", e);
                setOffline();
                if (serverOnline) {
                    currentDowntimeStart = new Date();
                    serverOnline = false;
                }
            }
            secondsSinceUpdate = 0;
        }

        // Seconds counter for last update
        setInterval(() => {
            secondsSinceUpdate++;
            lastUpdate.textContent = `Last update: ${secondsSinceUpdate}s ago`;
        }, 1000);

        // Polling
        updateStatus();
        setInterval(updateStatus, POLL_INTERVAL);

        // Steam button
        document.getElementById("open-steam").addEventListener("click", () => {
            window.location.href = "steam://rungameid/1541710";
        });
    </script>

</body>

</html>